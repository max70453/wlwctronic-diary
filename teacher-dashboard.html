<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Journal - Кабинет преподавателя</title>
    <!-- Material-UI CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mui/icons-material@5.11.0/fonts/index.css" />
    <!-- Ваши стили -->
    <link rel="stylesheet" href="css/global.css">
    <style>
        :root {
            --primary-color: #3f51b5;
            --secondary-color: #ff4081;
            --background-color: #f5f7fa;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: #333;
            line-height: 1.6;
        }

        /* AppBar styles */
        .app-bar {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.3rem;
            color: white;
            text-decoration: none;
        }

        .logo-icon {
            font-size: 2rem;
            margin-right: 10px;
            color: #ffd700;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
            transition: color 0.3s;
            padding: 8px 12px;
            border-radius: 4px;
        }

        .nav-link:hover {
            color: #ffd700;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .logout-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .dashboard-container {
            padding: 12px 16px;
            max-width: 1200px;
            margin: 0 auto;
            overflow-x: hidden;
        }

        .MuiPaper-root {
            margin-bottom: 16px;
            padding: 18px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .MuiPaper-root:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .content-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .teacher-info {
            text-align: center;
            padding: 20px;
        }

        .teacher-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2rem;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--background-color);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .class-card {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .class-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(63, 81, 181, 0.1);
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .class-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .students-count {
            background: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .schedule-list, .grades-list, .homework-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .schedule-item, .grade-item, .homework-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-item:last-child, .grade-item:last-child, .homework-item:last-child {
            border-bottom: none;
        }

        .schedule-time {
            font-weight: 500;
            color: var(--primary-color);
            min-width: 80px;
        }

        .schedule-room {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .grade-value {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .grade-good { background: #c8e6c9; color: #2e7d32; }
        .grade-mid { background: #fff3cd; color: #f57c00; }
        .grade-bad { background: #ffcdd2; color: #c62828; }

        .homework-priority {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .priority-high { background: #ffebee; color: #c62828; }
        .priority-medium { background: #fff3cd; color: #f57c00; }
        .priority-low { background: #e8f5e8; color: #2e7d32; }

        .announcement-item {
            padding: 15px;
            border-left: 4px solid var(--primary-color);
            background: var(--background-color);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .announcement-item.important {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .announcement-date {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        /* Footer */
        .footer {
            background-color: #1e283c;
            color: white;
            padding: 40px 20px 20px;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-section h4 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: white;
        }

        .footer-section p, .footer-section a {
            color: #ccc;
            text-decoration: none;
            margin-bottom: 10px;
            display: block;
            font-size: 0.9rem;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid #333;
            margin-top: 30px;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #999;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .content-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Material-UI AppBar -->
    <div id="app-bar"></div>

    <div class="dashboard-container">
        <div class="dashboard-grid">
            <!-- Левая боковая панель -->
            <div class="left-sidebar">
                <!-- Информация о преподавателе -->
                <div class="MuiPaper-root fade-in">
                    <div class="teacher-info">
                        <div class="teacher-avatar">
                            <i class="material-icons">person</i>
                        </div>
                        <h3 id="teacher-name">Загрузка...</h3>
                        <p id="teacher-subjects" style="color: #666; margin: 5px 0;">Загрузка...</p>
                        <p id="teacher-experience" style="color: #666; font-size: 0.9rem;">Загрузка...</p>
                    </div>
                </div>

                <!-- Статистика -->
                <div class="MuiPaper-root fade-in">
                    <h4 style="margin-top: 0;">Статистика</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="total-students">0</div>
                            <div class="stat-label">Учеников</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-classes">0</div>
                            <div class="stat-label">Группы</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="lessons-week">0</div>
                            <div class="stat-label">Пар/нед</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="main-content">
                <!-- Мои классы -->
                <div class="MuiPaper-root fade-in">
                    <h3 style="margin-top: 0;">Мои группы</h3>
                    <div id="teacher-classes">
                        <p>Загрузка классов...</p>
                    </div>
                </div>

                <!-- Таблица оценок -->
                <div class="MuiPaper-root fade-in">
                    <h3 style="margin-top: 0;">Журнал оценок</h3>
                    
                    <!-- Фильтры -->
                    <div class="filters-container" style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Группа:</label>
                            <select id="filter-group" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Все группы</option>
                                <option value="2ПО-25">2ПО-25</option>
                                <option value="1КСК-25">1КСК-25</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Предмет:</label>
                            <select id="filter-subject" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Все предметы</option>
                                <option value="Информатика">Информатика</option>
                                <option value="Базы данных">Базы данных</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Тип работы:</label>
                            <select id="filter-type" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Все типы</option>
                                <option value="Контрольная работа">Контрольная работа</option>
                                <option value="Самостоятельная работа">Самостоятельная работа</option>
                                <option value="Лабораторная работа">Лабораторная работа</option>
                                <option value="Устный ответ">Устный ответ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Оценка:</label>
                            <select id="filter-grade" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Все оценки</option>
                                <option value="5">5</option>
                                <option value="4">4</option>
                                <option value="3">3</option>
                                <option value="2">2</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; align-items: flex-end;">
                            <button onclick="applyFilters()" style="padding: 8px 16px; background: #3f51b5; color: white; border: none; border-radius: 4px; cursor: pointer;">Применить</button>
                        </div>
                    </div>

                    <!-- Таблица -->
                    <div class="grades-table-container" style="overflow-x: auto;">
                        <table class="grades-table" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">ФИО</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Предмет</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Дата</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Тип работы</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Оценка</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Итоговая оценка</th>
                                </tr>
                            </thead>
                            <tbody id="grades-table-body">
                                <!-- Данные будут загружены через JavaScript -->
                            </tbody>
                        </table>
                        
                        <!-- Пагинация -->
                        <div class="pagination-container" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                            <div class="pagination-info" style="color: #666; font-size: 0.9rem;">
                                Показано <span id="start-record">1</span>-<span id="end-record">5</span> из <span id="total-records">0</span> записей
                            </div>
                            <div class="pagination-controls" style="display: flex; gap: 10px; align-items: center;">
                                <button id="first-page" onclick="goToFirstPage()" style="padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&laquo;</button>
                                <button id="prev-page" onclick="goToPrevPage()" style="padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&lsaquo;</button>
                                <div id="page-numbers" style="display: flex; gap: 5px;">
                                    <!-- Номера страниц будут сгенерированы -->
                                </div>
                                <button id="next-page" onclick="goToNextPage()" style="padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&rsaquo;</button>
                                <button id="last-page" onclick="goToLastPage()" style="padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&raquo;</button>
                            </div>
                            <div class="page-size-selector" style="display: flex; align-items: center; gap: 10px;">
                                <label style="font-size: 0.9rem; color: #666;">Записей на странице:</label>
                                <select id="page-size" onchange="changePageSize()" style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9rem;">
                                    <option value="5">5</option>
                                    <option value="10" selected>10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-row">
                    <!-- Расписание -->
                    <div class="MuiPaper-root fade-in">
                        <h3 style="margin-top: 0;">Расписание на сегодня</h3>
                        <div id="today-schedule">
                            <p>Загрузка расписания...</p>
                        </div>
                    </div>

                    <!-- Объявления -->
                    <div class="MuiPaper-root fade-in">
                        <h3 style="margin-top: 0;">Объявления</h3>
                        <div id="teacher-announcements">
                            <p>Загрузка объявлений...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>E-Journal</h4>
                <p>Инновационная платформа для управления учебным процессом</p>
            </div>
            <div class="footer-section">
                <h4>Ссылки</h4>
                <a href="index.html">Главная</a>
                <a href="#">О платформе</a>
                <a href="#">Поддержка</a>
                <a href="#">Контакты</a>
            </div>
            <div class="footer-section">
                <h4>Контакты</h4>
                <p><i class="material-icons" style="font-size: 1rem; vertical-align: middle;">email</i> info@E-Journal.ru</p>
                <p><i class="material-icons" style="font-size: 1rem; vertical-align: middle;">phone</i> +7 (123) 456-78-90</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 E-Journal. Все права защищены.</p>
        </div>
    </footer>

    <!-- Material-UI JS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.11.0/umd/material-ui.production.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@mui/icons-material@5.11.0/umd/material-ui-icons.production.min.js"></script> -->
    <script src="js/teacher-data.js"></script>
    <script src="js/auth.js"></script>

    <script>
        // Временная аутентификация для теста
        if (!localStorage.getItem('isAuthenticated')) {
            console.log('Устанавливаем временную аутентификацию для теста');
            localStorage.setItem('isAuthenticated', 'true');
            localStorage.setItem('userRole', 'teacher');
            localStorage.setItem('username', 'test');
            localStorage.setItem('teacherId', 'teacher1');
        }
        
        // Инициализация AppBar с улучшенным дизайном
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Базовый тест - DOM загружен');
            
            const teacherId = 'teacher1';
            console.log('Teacher ID:', teacherId);
            
            // Простой тест - изменим заголовок
            const title = document.querySelector('h1');
            if (title) {
                title.textContent = 'Дашборд преподавателя - ТЕСТ';
                console.log('Заголовок изменен');
            } else {
                console.log('Заголовок не найден');
            }
            
            // Загружаем данные преподавателя
            loadTeacherDashboard(teacherId);
        });

        // Основная функция загрузки дашборда
        function loadTeacherDashboard(teacherId) {
            console.log('loadTeacherDashboard вызывается с ID:', teacherId);
            console.log('=== ЗАГРУЗКА ДАШБОРДА ПРЕПОДАВАТЕЛЯ ===');
            
            try {
                const teacherData = getTeacherData(teacherId);
                console.log('Данные преподавателя получены:', teacherData);
                
                if (teacherData) {
                    console.log('✅ Данные преподавателя загружены:', teacherData);
                    
                    // Заполняем основную информацию
                    populateTeacherInfo(teacherData);
                    
                    // Заполняем статистику
                    populateStatistics(teacherData);
                    
                    populateClasses(teacherData);
                    
                    populateSchedule(teacherData);
                    
                    populateAnnouncements(teacherData);
                    
                    populateGradesTable(teacherData);
                    
                    // Добавляем анимации
                    addAnimations();
                } else {
                    console.error('❌ Данные преподавателя не найдены');
                    showError('Данные преподавателя не найдены');
                }
            } catch (error) {
                console.error('Ошибка при загрузке дашборда:', error);
                showError('Ошибка при загрузке дашборда: ' + error.message);
            }
        }

        // Заполнение информации о преподавателе
        function populateTeacherInfo(teacher) {
            console.log('Заполнение информации о преподавателе');
            
            const nameElement = document.getElementById('teacher-name');
            const subjectsElement = document.getElementById('teacher-subjects');
            const experienceElement = document.getElementById('teacher-experience');
            
            if (nameElement) nameElement.textContent = teacher.name;
            if (subjectsElement) subjectsElement.textContent = teacher.subjects.join(', ');
            if (experienceElement) experienceElement.textContent = teacher.experience;
        }

        // Заполнение статистики
        function populateStatistics(teacher) {
            document.getElementById('total-students').textContent = teacher.statistics.totalStudents;
            document.getElementById('total-classes').textContent = teacher.statistics.classesCount;
            
            // Средняя оценка удалена из интерфейса
            // const avgGrades = Object.values(teacher.statistics.averageGrades);
            // const overallAvg = (avgGrades.reduce((a, b) => a + b, 0) / avgGrades.length).toFixed(1);
            // document.getElementById('avg-grade').textContent = overallAvg;
            
            document.getElementById('lessons-week').textContent = teacher.statistics.lessonsPerWeek;
        }

        // Заполнение классов
        function populateClasses(teacher) {
            const classesContainer = document.getElementById('teacher-classes');
            
            if (teacher.classes && teacher.classes.length > 0) {
                let html = '';
                teacher.classes.forEach(cls => {
                    html += `
                        <div class="class-card">
                            <div class="class-header">
                                <div>
                                    <div class="class-name">${cls.name}</div>
                                    <div style="color: #666; font-size: 0.9rem;">${cls.subject}</div>
                                </div>
                                <div class="students-count">${cls.students} уч.</div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="mui-btn" style="font-size: 0.8rem; padding: 4px 8px;" onclick="console.log('Grade clicked for ${cls.id}'); showGradeForm('${cls.id}', '${cls.name}')">
                                    <i class="material-icons" style="font-size: 0.9rem;">grade</i> Оценки
                                </button>
                                <button class="mui-btn" style="font-size: 0.8rem; padding: 4px 8px;" onclick="console.log('Students list clicked for ${cls.id}'); showStudentsList('${cls.id}', '${cls.name}')">
                                    <i class="material-icons" style="font-size: 0.9rem;">people</i> Список группы
                                </button>
                            </div>
                        </div>
                    `;
                });
                classesContainer.innerHTML = html;
                
                // Добавляем отладочную информацию
                console.log('Классы загружены:', teacher.classes);
                console.log('Функции доступны:', typeof showGradeForm, typeof showStudentsList);
            } else {
                classesContainer.innerHTML = '<p>Классы не найдены</p>';
            }
        }

        // Заполнение расписания
        function populateSchedule(teacher) {
            const scheduleContainer = document.getElementById('today-schedule');
            const today = new Date().toLocaleDateString('ru-RU', { weekday: 'long' });
            
            console.log('Сегодня:', today);
            console.log('Все расписание:', teacher.schedule);
            
            const todaySchedule = teacher.schedule.filter(lesson => 
                lesson.day.toLowerCase() === today.toLowerCase()
            );
            
            console.log('Расписание на сегодня:', todaySchedule);
            
            if (todaySchedule.length > 0) {
                let html = '<ul class="schedule-list">';
                todaySchedule.forEach(lesson => {
                    html += `
                        <li class="schedule-item">
                            <div>
                                <div class="schedule-time">${lesson.time}</div>
                                <div>${lesson.class} - ${lesson.subject}</div>
                            </div>
                            <div class="schedule-room">${lesson.room}</div>
                        </li>
                    `;
                });
                html += '</ul>';
                scheduleContainer.innerHTML = html;
            } else {
                // Если на сегодня нет занятий, покажем расписание на завтра
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowDay = tomorrow.toLocaleDateString('ru-RU', { weekday: 'long' });
                
                console.log('Завтра:', tomorrowDay);
                
                const tomorrowSchedule = teacher.schedule.filter(lesson => 
                    lesson.day.toLowerCase() === tomorrowDay.toLowerCase()
                );
                
                if (tomorrowSchedule.length > 0) {
                    let html = '<p style="margin-bottom: 10px; color: #666;"><strong>На сегодня занятий с группами нет</strong></p>';
                    html += '<p style="margin-bottom: 15px; color: #666;">Расписание на завтра (' + tomorrowDay + '):</p>';
                    html += '<ul class="schedule-list">';
                    tomorrowSchedule.forEach(lesson => {
                        html += `
                            <li class="schedule-item">
                                <div>
                                    <div class="schedule-time">${lesson.time}</div>
                                    <div>${lesson.class} - ${lesson.subject}</div>
                                </div>
                                <div class="schedule-room">${lesson.room}</div>
                            </li>
                        `;
                    });
                    html += '</ul>';
                    scheduleContainer.innerHTML = html;
                } else {
                    scheduleContainer.innerHTML = '<p>На ближайшие дни занятий с группами нет</p>';
                }
            }
        }

        // Загрузка данных для таблицы оценок
        function populateGradesTable(teacher) {
            const tableBody = document.getElementById('grades-table-body');
            
            // Mock данные для оценок (расширенные для демонстрации пагинации)
            const gradesData = [
                { id: 1, student: 'Петров А.С.', group: '2ПО-25', subject: 'Информатика', date: '28.01.2026', type: 'Контрольная работа', grade: '5', finalGrade: '4.5' },
                { id: 2, student: 'Иванов П.И.', group: '2ПО-25', subject: 'Информатика', date: '27.01.2026', type: 'Самостоятельная работа', grade: '4', finalGrade: '4.2' },
                { id: 3, student: 'Сидорова М.И.', group: '2ПО-25', subject: 'Информатика', date: '26.01.2026', type: 'Лабораторная работа', grade: '5', finalGrade: '4.8' },
                { id: 4, student: 'Козлов Д.В.', group: '1КСК-25', subject: 'Базы данных', date: '25.01.2026', type: 'Устный ответ', grade: '3', finalGrade: '3.5' },
                { id: 5, student: 'Новикова Е.А.', group: '1КСК-25', subject: 'Базы данных', date: '24.01.2026', type: 'Контрольная работа', grade: '4', finalGrade: '4.1' },
                { id: 6, student: 'Морозов К.С.', group: '1КСК-25', subject: 'Базы данных', date: '23.01.2026', type: 'Лабораторная работа', grade: '5', finalGrade: '4.7' },
                { id: 7, student: 'Волкова О.Н.', group: '2ПО-25', subject: 'Информатика', date: '22.01.2026', type: 'Самостоятельная работа', grade: '4', finalGrade: '4.0' },
                { id: 8, student: 'Лебедев А.М.', group: '2ПО-25', subject: 'Информатика', date: '21.01.2026', type: 'Контрольная работа', grade: '5', finalGrade: '4.6' },
                { id: 9, student: 'Соколов В.И.', group: '1КСК-25', subject: 'Базы данных', date: '20.01.2026', type: 'Устный ответ', grade: '4', finalGrade: '4.3' },
                { id: 10, student: 'Коваленко Н.П.', group: '2ПО-25', subject: 'Информатика', date: '19.01.2026', type: 'Лабораторная работа', grade: '5', finalGrade: '4.9' },
                { id: 11, student: 'Мельникова Т.А.', group: '1КСК-25', subject: 'Базы данных', date: '18.01.2026', type: 'Контрольная работа', grade: '3', finalGrade: '3.8' },
                { id: 12, student: 'Тарасов Р.С.', group: '2ПО-25', subject: 'Информатика', date: '17.01.2026', type: 'Самостоятельная работа', grade: '4', finalGrade: '4.1' },
                { id: 13, student: 'Белова А.В.', group: '1КСК-25', subject: 'Базы данных', date: '16.01.2026', type: 'Лабораторная работа', grade: '5', finalGrade: '4.7' },
                { id: 14, student: 'Григорьев М.И.', group: '2ПО-25', subject: 'Информатика', date: '15.01.2026', type: 'Контрольная работа', grade: '4', finalGrade: '4.2' },
                { id: 15, student: 'Дмитриева Е.С.', group: '1КСК-25', subject: 'Базы данных', date: '14.01.2026', type: 'Устный ответ', grade: '5', finalGrade: '4.8' }
            ];
            
            // Сохраняем данные для фильтрации и пагинации
            window.allGradesData = gradesData;
            window.filteredGradesData = gradesData;
            window.currentPage = 1;
            window.pageSize = 10;
            
            // Отображаем первую страницу
            displayGradesWithPagination();
        }

        // Отображение оценок с пагинацией
        function displayGradesWithPagination() {
            const data = window.filteredGradesData || [];
            const currentPage = window.currentPage || 1;
            const pageSize = parseInt(document.getElementById('page-size').value) || 10;
            
            // Вычисляем пагинацию
            const totalPages = Math.ceil(data.length / pageSize);
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, data.length);
            const pageData = data.slice(startIndex, endIndex);
            
            // Отображаем данные текущей страницы
            displayGrades(pageData);
            
            // Обновляем пагинацию
            updatePagination(data.length, currentPage, totalPages, startIndex + 1, endIndex);
        }

        // Обновление элементов пагинации
        function updatePagination(totalRecords, currentPage, totalPages, startRecord, endRecord) {
            // Обновляем информацию о записях
            document.getElementById('start-record').textContent = totalRecords > 0 ? startRecord : 0;
            document.getElementById('end-record').textContent = endRecord;
            document.getElementById('total-records').textContent = totalRecords;
            
            // Обновляем состояние кнопок
            document.getElementById('first-page').disabled = currentPage === 1;
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
            document.getElementById('last-page').disabled = currentPage === totalPages;
            
            // Генерируем номера страниц
            const pageNumbers = document.getElementById('page-numbers');
            pageNumbers.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.onclick = () => goToPage(i);
                pageButton.style.cssText = `
                    padding: 6px 10px;
                    border: 1px solid ${i === currentPage ? '#3f51b5' : '#ddd'};
                    background: ${i === currentPage ? '#3f51b5' : 'white'};
                    color: ${i === currentPage ? 'white' : '#333'};
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 0.8rem;
                `;
                pageNumbers.appendChild(pageButton);
            }
        }

        // Функции навигации по страницам
        function goToFirstPage() {
            window.currentPage = 1;
            displayGradesWithPagination();
        }

        function goToPrevPage() {
            if (window.currentPage > 1) {
                window.currentPage--;
                displayGradesWithPagination();
            }
        }

        function goToNextPage() {
            const totalPages = Math.ceil((window.filteredGradesData || []).length / window.pageSize);
            if (window.currentPage < totalPages) {
                window.currentPage++;
                displayGradesWithPagination();
            }
        }

        function goToLastPage() {
            const totalPages = Math.ceil((window.filteredGradesData || []).length / window.pageSize);
            window.currentPage = totalPages;
            displayGradesWithPagination();
        }

        function goToPage(pageNumber) {
            window.currentPage = pageNumber;
            displayGradesWithPagination();
        }

        function changePageSize() {
            window.pageSize = parseInt(document.getElementById('page-size').value);
            window.currentPage = 1; // Сбрасываем на первую страницу
            displayGradesWithPagination();
        }

        // Отображение оценок в таблице
        function displayGrades(data) {
            const tableBody = document.getElementById('grades-table-body');
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Данные не найдены</td></tr>';
                return;
            }
            
            let html = '';
            data.forEach(item => {
                html += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 12px;">${item.student}</td>
                        <td style="padding: 12px;">${item.subject}</td>
                        <td style="padding: 12px;">${item.date}</td>
                        <td style="padding: 12px;">${item.type}</td>
                        <td style="padding: 12px;">
                            <span style="background: ${getGradeColor(item.grade)}; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold;">
                                ${item.grade}
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <input type="number" 
                                   value="${item.finalGrade}" 
                                   min="2" 
                                   max="5" 
                                   step="0.1"
                                   onchange="updateFinalGrade(${item.id}, this.value)"
                                   style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // Получение цвета для оценки
        function getGradeColor(grade) {
            switch(grade) {
                case '5': return '#4caf50';
                case '4': return '#2196f3';
                case '3': return '#ff9800';
                case '2': return '#f44336';
                default: return '#9e9e9e';
            }
        }

        // Применение фильтров
        function applyFilters() {
            const groupFilter = document.getElementById('filter-group').value;
            const subjectFilter = document.getElementById('filter-subject').value;
            const typeFilter = document.getElementById('filter-type').value;
            const gradeFilter = document.getElementById('filter-grade').value;
            
            let filteredData = window.allGradesData;
            
            if (groupFilter) {
                filteredData = filteredData.filter(item => item.group === groupFilter);
            }
            
            if (subjectFilter) {
                filteredData = filteredData.filter(item => item.subject === subjectFilter);
            }
            
            if (typeFilter) {
                filteredData = filteredData.filter(item => item.type === typeFilter);
            }
            
            if (gradeFilter) {
                filteredData = filteredData.filter(item => item.grade === gradeFilter);
            }
            
            // Сохраняем отфильтрованные данные и сбрасываем на первую страницу
            window.filteredGradesData = filteredData;
            window.currentPage = 1;
            
            // Отображаем с пагинацией
            displayGradesWithPagination();
        }

        // Обновление итоговой оценки
        function updateFinalGrade(studentId, newGrade) {
            console.log(`Обновление итоговой оценки для студента ${studentId}: ${newGrade}`);
            
            // Находим студента в данных
            const studentIndex = window.allGradesData.findIndex(item => item.id === studentId);
            if (studentIndex !== -1) {
                window.allGradesData[studentIndex].finalGrade = newGrade;
                
                // Показываем уведомление об успешном обновлении
                showNotification(`Итоговая оценка обновлена: ${newGrade}`);
            }
        }

        // Показ уведомления
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4caf50;
                color: white;
                padding: 12px 20px;
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Заполнение объявлений
        function populateAnnouncements(teacher) {
            const announcementsContainer = document.getElementById('teacher-announcements');
            
            if (teacher.announcements && teacher.announcements.length > 0) {
                let html = '';
                teacher.announcements.slice(0, 3).forEach(announcement => {
                    const importantClass = announcement.important ? 'important' : '';
                    html += `
                        <div class="announcement-item ${importantClass}">
                            <h5 style="margin: 0 0 5px 0;">${announcement.title}</h5>
                            <p style="margin: 0; font-size: 0.9rem;">${announcement.content}</p>
                            <div class="announcement-date">${announcement.date}</div>
                        </div>
                    `;
                });
                announcementsContainer.innerHTML = html;
            } else {
                announcementsContainer.innerHTML = '<p>Объявлений пока нет</p>';
            }
        }

        // Добавление анимаций
        function addAnimations() {
            const fadeInElements = document.querySelectorAll('.fade-in');
            fadeInElements.forEach((element, index) => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    element.style.transition = 'all 0.5s ease';
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }

        // Показать ошибку
        function showError(message) {
            const container = document.querySelector('.dashboard-container');
            container.innerHTML = `
                <div class="MuiPaper-root" style="text-align: center; padding: 40px;">
                    <i class="material-icons" style="font-size: 4rem; color: #f44336; margin-bottom: 20px;">error</i>
                    <h3>Ошибка</h3>
                    <p>${message}</p>
                    <button class="mui-btn" onclick="location.reload()">Обновить страницу</button>
                </div>
            `;
        }

        // Функции для форм
        function showGradeForm(classId, className) {
            console.log('showGradeForm called with:', classId, className);
            console.log('showGradeModal function exists:', typeof showGradeModal);
            try {
                showGradeModal(classId, className);
            } catch (error) {
                console.error('Error in showGradeModal:', error);
                alert('Ошибка при открытии формы оценок: ' + error.message);
            }
        }

        function showStudentsList(classId, className) {
            console.log('showStudentsList called with:', classId, className);
            
            // Создаем текстовый файл со списком студентов
            const studentsData = [
                '1. Петров А.С.',
                '2. Иванов П.И.',
                '3. Сидорова М.И.',
                '4. Козлов Д.В.',
                '5. Новикова Е.А.',
                '6. Морозов К.С.',
                '7. Волкова О.Н.',
                '8. Лебедев А.М.',
                '9. Соколов В.И.',
                '10. Коваленко Н.П.',
                '11. Мельникова Т.А.',
                '12. Тарасов Р.С.'
            ];
            
            const fileContent = `Список группы ${className}\n` +
                              `Дата формирования: ${new Date().toLocaleDateString('ru-RU')}\n` +
                              `${'='.repeat(50)}\n\n` +
                              studentsData.join('\n');
            
            // Создаем Blob и скачиваем файл
            const blob = new Blob([fileContent], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `список_группы_${className.replace(/[^a-zA-Z0-9]/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            console.log('Файл со списком студентов создан и скачан');
        }

        // Закрытие модального окна
        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // Показать успешное сообщение
        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.innerHTML = '<i class="material-icons">check_circle</i><span>' + message + '</span>';

            // Добавляем стили для успешного сообщения
            if (!document.getElementById('success-styles')) {
                const style = document.createElement('style');
                style.id = 'success-styles';
                style.textContent = `
                    .success-message {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #4caf50;
                        color: white;
                        padding: 16px 20px;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        z-index: 2000;
                        animation: slideInRight 0.3s ease;
                        max-width: 400px;
                    }

                    .success-message i {
                        font-size: 1.5rem;
                    }

                    @keyframes slideInRight {
                        from {
                            opacity: 0;
                            transform: translateX(100px);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }

                    @media (max-width: 768px) {
                        .success-message {
                            right: 10px;
                            left: 10px;
                            max-width: none;
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(successDiv);

            // Автоматически удаляем через 3 секунды
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }

        // Функция обновления списка студентов при выборе группы
        function updateStudentsList(groupId) {
            const studentSelect = document.getElementById('grade-student');
            if (!studentSelect) return;
            
            // Списки студентов по группам
            const studentsByGroup = {
                '2ПО-25': [
                    'Петров А.С.',
                    'Иванов П.И.',
                    'Сидорова М.И.',
                    'Козлов Д.В.',
                    'Новикова Е.А.',
                    'Морозов К.С.',
                    'Волкова О.Н.',
                    'Лебедев А.М.',
                    'Соколов В.И.',
                    'Коваленко Н.П.',
                    'Мельникова Т.А.',
                    'Тарасов Р.С.'
                ],
                '1КСК-25': [
                    'Алексеев А.А.',
                    'Белов Б.Б.',
                    'Васильева В.В.',
                    'Григорьев Г.Г.',
                    'Дмитриева Д.Д.',
                    'Егоров Е.Е.',
                    'Жукова Ж.Ж.',
                    'Зайцев З.З.',
                    'Ильина И.И.',
                    'Ковалев К.К.'
                ]
            };
            
            // Очищаем список студентов
            studentSelect.innerHTML = '<option value="">Выберите ученика</option>';
            
            // Добавляем студентов выбранной группы
            if (studentsByGroup[groupId]) {
                studentsByGroup[groupId].forEach(student => {
                    const option = document.createElement('option');
                    option.value = student;
                    option.textContent = student;
                    studentSelect.appendChild(option);
                });
            }
        }

        // Модальное окно для выставления оценок
        function showGradeModal(classId, className) {
            console.log('showGradeModal started with:', classId, className);
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Выставить оценку</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="grade-form">
                            <input type="hidden" id="grade-class-id" value="${classId}">
                            <input type="hidden" id="grade-class-name" value="${className}">
                            
                            <div class="form-group">
                                <label for="grade-group">Группа</label>
                                <select id="grade-group" class="form-control" required>
                                    <option value="">Выберите группу</option>
                                    <option value="2ПО-25">2ПО-25</option>
                                    <option value="1КСК-25">1КСК-25</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="grade-student">Ученик</label>
                                <select id="grade-student" class="form-control" required>
                                    <option value="">Выберите ученика</option>
                                    <option value="Петров А.С.">Петров А.С.</option>
                                    <option value="Иванов П.И.">Иванов П.И.</option>
                                    <option value="Сидорова М.И.">Сидорова М.И.</option>
                                    <option value="Козлов Д.В.">Козлов Д.В.</option>
                                    <option value="Новикова Е.А.">Новикова Е.А.</option>
                                    <option value="Морозов К.С.">Морозов К.С.</option>
                                    <option value="Волкова О.Н.">Волкова О.Н.</option>
                                    <option value="Лебедев А.М.">Лебедев А.М.</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="grade-subject">Предмет</label>
                                <select id="grade-subject" class="form-control" required>
                                    <option value="">Выберите предмет</option>
                                    <option value="Математика">Математика</option>
                                    <option value="Физика">Физика</option>
                                    <option value="Русский язык">Русский язык</option>
                                    <option value="Литература">Литература</option>
                                    <option value="История">История</option>
                                    <option value="Биология">Биология</option>
                                    <option value="Химия">Химия</option>
                                    <option value="География">География</option>
                                    <option value="Информатика">Информатика</option>
                                    <option value="Английский язык">Английский язык</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="grade-value">Оценка</label>
                                    <select id="grade-value" class="form-control" required>
                                        <option value="">Выберите оценку</option>
                                        <option value="5">5 (Отлично)</option>
                                        <option value="4">4 (Хорошо)</option>
                                        <option value="3">3 (Удовлетворительно)</option>
                                        <option value="2">2 (Неудовлетворительно)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="grade-date">Дата</label>
                                    <input type="date" id="grade-date" class="form-control" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="grade-topic">Тема/Тип работы</label>
                                <select id="grade-topic" class="form-control" required>
                                    <option value="">Выберите тип работы</option>
                                    <option value="Устный ответ">Устный ответ</option>
                                    <option value="Письменная работа">Письменная работа</option>
                                    <option value="Контрольная работа">Контрольная работа</option>
                                    <option value="Самостоятельная работа">Самостоятельная работа</option>
                                    <option value="Лабораторная работа">Лабораторная работа</option>
                                    <option value="Практическая работа">Практическая работа</option>
                                    <option value="Тест">Тест</option>
                                    <option value="Зачет">Зачет</option>
                                    <option value="Экзамен">Экзамен</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="grade-comment">Комментарий (необязательно)</label>
                                <textarea id="grade-comment" class="form-control" rows="3" placeholder="Дополнительные комментарии к оценке"></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeModal()">Отмена</button>
                                <button type="submit" class="btn btn-primary">Выставить оценку</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            
            // Добавляем стили для модального окна оценок если их еще нет
            if (!document.getElementById('grade-modal-styles')) {
                const style = document.createElement('style');
                style.id = 'grade-modal-styles';
                style.textContent = `
                    .modal-overlay {
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        right: 0 !important;
                        bottom: 0 !important;
                        background: rgba(0, 0, 0, 0.5) !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        z-index: 9999 !important;
                    }
                    .modal-content {
                        background: white !important;
                        border-radius: 12px !important;
                        width: 90% !important;
                        max-width: 600px !important;
                        max-height: 90vh !important;
                        overflow-y: auto !important;
                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
                        margin: 0 !important;
                        padding: 0 !important;
                    }
                    .modal-header {
                        display: flex !important;
                        justify-content: space-between !important;
                        align-items: center !important;
                        padding: 20px 24px !important;
                        border-bottom: 1px solid #e0e0e0 !important;
                        background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%) !important;
                        color: white !important;
                        border-radius: 12px 12px 0 0 !important;
                        margin: 0 !important;
                    }
                    .modal-header h3 {
                        margin: 0 !important;
                        font-size: 1.5rem !important;
                        font-weight: 500 !important;
                        color: white !important;
                    }
                    .modal-close {
                        background: none !important;
                        border: none !important;
                        color: white !important;
                        font-size: 1.5rem !important;
                        cursor: pointer !important;
                        padding: 4px !important;
                        border-radius: 4px !important;
                        transition: background-color 0.2s !important;
                    }
                    .modal-close:hover {
                        background-color: rgba(255, 255, 255, 0.1) !important;
                    }
                    .modal-body {
                        padding: 24px !important;
                    }
                    .form-group {
                        margin-bottom: 20px !important;
                    }
                    .form-group label {
                        display: block !important;
                        margin-bottom: 8px !important;
                        font-weight: 500 !important;
                        color: #333 !important;
                    }
                    .form-group input,
                    .form-group select,
                    .form-group textarea {
                        width: 100% !important;
                        padding: 12px !important;
                        border: 2px solid #e0e0e0 !important;
                        border-radius: 8px !important;
                        font-size: 14px !important;
                        transition: border-color 0.2s !important;
                        box-sizing: border-box !important;
                    }
                    .form-group input:focus,
                    .form-group select:focus,
                    .form-group textarea:focus {
                        outline: none !important;
                        border-color: #3f51b5 !important;
                        box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.1) !important;
                    }
                    .form-actions {
                        display: flex !important;
                        justify-content: flex-end !important;
                        gap: 12px !important;
                        margin-top: 24px !important;
                        padding-top: 20px !important;
                        border-top: 1px solid #e0e0e0 !important;
                    }
                    .btn {
                        padding: 12px 24px !important;
                        border: none !important;
                        border-radius: 8px !important;
                        font-size: 14px !important;
                        font-weight: 500 !important;
                        cursor: pointer !important;
                        transition: all 0.2s !important;
                        display: inline-flex !important;
                        align-items: center !important;
                        gap: 8px !important;
                    }
                    .btn-primary {
                        background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%) !important;
                        color: white !important;
                    }
                    .btn-primary:hover {
                        background: linear-gradient(135deg, #303f9f 0%, #283593 100%) !important;
                        transform: translateY(-1px) !important;
                        box-shadow: 0 4px 12px rgba(63, 81, 181, 0.3) !important;
                    }
                    .btn-secondary {
                        background: #f5f5f5 !important;
                        color: #666 !important;
                    }
                    .btn-secondary:hover {
                        background: #e0e0e0 !important;
                    }
                    .material-icons {
                        font-size: 18px !important;
                    }
                `;
                document.head.appendChild(style);
            }
            
            console.log('Modal added to DOM');
            
            // Проверяем, что модальное окно добавлено
            setTimeout(() => {
                const addedModal = document.querySelector('.modal-overlay');
                console.log('Modal found in DOM:', !!addedModal);
                if (addedModal) {
                    console.log('Modal HTML length:', addedModal.innerHTML.length);
                    console.log('Modal contains grade form:', addedModal.innerHTML.includes('Выставить оценку'));
                    console.log('Modal computed style display:', window.getComputedStyle(addedModal).display);
                    console.log('Modal computed style visibility:', window.getComputedStyle(addedModal).visibility);
                    console.log('Modal computed style opacity:', window.getComputedStyle(addedModal).opacity);
                    
                    // Применяем стандартные стили как в форме ДЗ
                    addedModal.style.background = 'rgba(0, 0, 0, 0.5)';
                    addedModal.style.display = 'flex !important';
                    addedModal.style.alignItems = 'center !important';
                    addedModal.style.justifyContent = 'center !important';
                    addedModal.style.zIndex = '1000 !important';
                    
                    console.log('Applied debug styles to modal');
                }
            }, 100);

            // Устанавливаем текущую дату
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('grade-date');
            if (dateInput) {
                dateInput.max = today; // Нельзя выставить оценку на будущую дату
                dateInput.value = today;
                console.log('Date set to:', today);
            } else {
                console.error('Date input not found!');
            }

            // Обработчик изменения группы
            const groupSelect = document.getElementById('grade-group');
            if (groupSelect) {
                groupSelect.addEventListener('change', function() {
                    updateStudentsList(this.value);
                });
                console.log('Group select event listener added');
            } else {
                console.error('Group select not found!');
            }

            // Обработчик отправки формы
            const form = document.getElementById('grade-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    submitGrade();
                });
                console.log('Form event listener added');
            } else {
                console.error('Form not found!');
            }
        }

        // Отправка оценки
        function submitGrade() {
            const classId = document.getElementById('grade-class-id').value;
            const className = document.getElementById('grade-class-name').value;
            const group = document.getElementById('grade-group').value;
            const student = document.getElementById('grade-student').value;
            const subject = document.getElementById('grade-subject').value;
            const grade = document.getElementById('grade-value').value;
            const date = document.getElementById('grade-date').value;
            const topic = document.getElementById('grade-topic').value;
            const comment = document.getElementById('grade-comment').value;

            // Валидация
            if (!group || !student || !subject || !grade || !date || !topic) {
                alert('Пожалуйста, заполните все обязательные поля');
                return;
            }

            // Получаем данные преподавателя
            const teacherId = localStorage.getItem('teacherId') || 'teacher1';
            const teacherData = getTeacherData(teacherId);

            // Создаем новую оценку
            const newGrade = {
                id: Date.now(),
                group: group,
                student: student,
                class: className,
                subject: subject,
                grade: grade,
                date: date,
                topic: topic,
                comment: comment,
                createdDate: new Date().toLocaleDateString('ru-RU'),
                teacher: teacherData.name
            };

            // Добавляем в массив оценок
            if (!teacherData.recentGrades) {
                teacherData.recentGrades = [];
            }
            teacherData.recentGrades.unshift(newGrade);

            // Сохраняем в localStorage
            saveTeacherData(teacherId, teacherData);

            // Показываем успешное сообщение
            showSuccessMessage(`Оценка "${grade}" успешно выставлена ученику ${student} из группы ${group}!`);

            // Закрываем модальное окно
            closeModal();
        }

        // Делаем submitGrade глобально доступной
        window.submitGrade = submitGrade;

        // Делаем все функции глобально доступными
        window.showGradeForm = showGradeForm;
        window.showStudentsList = showStudentsList;
        window.closeModal = closeModal;
        window.applyFilters = applyFilters;
        window.updateFinalGrade = updateFinalGrade;
        window.goToFirstPage = goToFirstPage;
        window.goToPrevPage = goToPrevPage;
        window.goToNextPage = goToNextPage;
        window.goToLastPage = goToLastPage;
        window.goToPage = goToPage;
        window.changePageSize = changePageSize;

        function logout() {
            localStorage.removeItem('teacherId');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
